<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>50. Yƒ±l Dedeman Fen ve Teknoloji Anadolu ƒ∞HL</title>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;700&display=swap" rel="stylesheet">
    
    <style>
        body { font-family: 'Roboto', sans-serif; background-color: #f0f2f5; margin: 0; padding: 0; }
        header { background-color: #2c3e50; color: white; padding: 15px 20px; text-align: center; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
        .logo { font-size: 1.1rem; font-weight: bold; line-height: 1.4; }
        main { max-width: 600px; margin: 20px auto; padding: 0 10px; }
        
        .post-box, .card { background: white; padding: 20px; border-radius: 15px; box-shadow: 0 1px 3px rgba(0,0,0,0.1); margin-bottom: 20px; }
        textarea, .reply-input { width: 100%; height: 60px; padding: 10px; border: 1px solid #ddd; border-radius: 10px; resize: none; box-sizing: border-box; font-size: 1rem; }
        
        .preview-container { display: flex; flex-wrap: wrap; gap: 8px; margin: 10px 0; }
        .preview-item { position: relative; width: 60px; height: 60px; border: 1px solid #ddd; border-radius: 8px; overflow: hidden; background: #eee; }
        .preview-item img, .preview-item video { width: 100%; height: 100%; object-fit: cover; }
        .remove-btn { position: absolute; top: 0; right: 0; background: red; color: white; border: none; border-radius: 50%; width: 18px; height: 18px; cursor: pointer; font-size: 10px; z-index: 5; }
        
        .file-label { display: inline-block; margin-top: 10px; padding: 8px 12px; background: #34495e; color: white; border-radius: 5px; cursor: pointer; font-size: 0.8rem; }
        .main-btn { background-color: #27ae60; color: white; border: none; padding: 10px; margin-top: 10px; border-radius: 5px; cursor: pointer; font-weight: bold; width: 100%; }
        
        .bubble { background: #e7f3ff; padding: 12px; border-radius: 15px; border-top-left-radius: 2px; margin: 10px 0; }
        .media-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(100px, 1fr)); gap: 5px; margin-top: 8px; }
        .media-grid img, .media-grid video { width: 100%; border-radius: 8px; }
        audio { width: 100%; margin-top: 5px; }

        .actions { display: flex; gap: 8px; margin-bottom: 10px; margin-top: 5px; }
        .react-btn { background: #f8f9fa; border: 1px solid #ddd; border-radius: 15px; padding: 4px 10px; cursor: pointer; font-size: 0.8rem; display: flex; align-items: center; gap: 4px; }
        .react-btn.active { background: #d4edda; border-color: #27ae60; }
        
        .reply-item { background: #f1f0f0; padding: 10px; border-radius: 10px; margin-top: 10px; }
        .reply-media { margin-top: 5px; }
    </style>
</head>
<body>

<header>
    <div class="logo">50. Yƒ±l Dedeman Fen ve Teknoloji <br> Anadolu ƒ∞mam Hatip Lisesi</div>
</header>

<main>
    <div class="post-box">
        <textarea id="mainInput" placeholder="Anonim bir payla≈üƒ±mda bulunun..."></textarea>
        <div id="mainPrev" class="preview-container"></div>
        <label class="file-label">üìÅ Dosya Ekle <input type="file" id="mainFile" hidden multiple onchange="handleFiles(this, 'mainPrev', 'main')"></label>
        <button class="main-btn" onclick="submitPost()">Payla≈ü</button>
    </div>
    <div id="feed"></div>
</main>

<script>
    let postIdCounter = 0;
    let filesStore = { main: [] };

    function handleFiles(input, prevId, storeKey) {
        if (!filesStore[storeKey]) filesStore[storeKey] = [];
        Array.from(input.files).forEach(file => {
            const reader = new FileReader();
            reader.onload = (e) => {
                filesStore[storeKey].push({ data: e.target.result, type: file.type, id: Math.random() });
                renderPreviews(prevId, storeKey);
            };
            reader.readAsDataURL(file);
        });
        input.value = "";
    }

    function renderPreviews(prevId, storeKey) {
        const area = document.getElementById(prevId);
        area.innerHTML = "";
        filesStore[storeKey].forEach(file => {
            const div = document.createElement('div');
            div.className = 'preview-item';
            let content = file.type.startsWith('image/') ? `<img src="${file.data}">` : (file.type.startsWith('video/') ? `<video src="${file.data}"></video>` : `<div style="text-align:center;padding-top:15px">üéµ</div>`);
            div.innerHTML = `${content}<button class="remove-btn" onclick="removeFile('${storeKey}', ${file.id}, '${prevId}')">√ó</button>`;
            area.appendChild(div);
        });
    }

    function removeFile(storeKey, id, prevId) {
        filesStore[storeKey] = filesStore[storeKey].filter(f => f.id !== id);
        renderPreviews(prevId, storeKey);
    }

    function toggleLike(btn) {
        btn.classList.toggle('active');
        let span = btn.querySelector('span');
        let count = parseInt(span.innerText);
        span.innerText = btn.classList.contains('active') ? count + 1 : count - 1;
    }

    function submitPost() {
        const text = document.getElementById('mainInput').value;
        if (text.trim() === "" && filesStore.main.length === 0) return;
        postIdCounter++;
        renderCard(text, [...filesStore.main], postIdCounter);
        document.getElementById('mainInput').value = "";
        filesStore.main = [];
        renderPreviews('mainPrev', 'main');
    }

    function renderCard(text, files, id) {
        const card = document.createElement('div');
        card.className = 'card';
        let mediaHtml = '<div class="media-grid">' + files.map(f => {
            if (f.type.startsWith('image/')) return `<img src="${f.data}">`;
            if (f.type.startsWith('video/')) return `<video src="${f.data}" controls></video>`;
            return `</div><audio src="${f.data}" controls></audio><div class="media-grid">`;
        }).join('') + '</div>';

        card.innerHTML = `
            <div style="font-weight:bold; font-size:0.9rem;">Anonim Kullanƒ±cƒ±</div>
            <div class="bubble"><p style="margin:0;">${text}</p>${mediaHtml}</div>
            <div class="actions">
                <button class="react-btn" onclick="toggleLike(this)">üëç <span>0</span></button>
                <button class="react-btn" onclick="toggleLike(this)">‚ù§Ô∏è <span>0</span></button>
            </div>
            <div id="replies-${id}"></div>
            <div style="margin-top:15px; border-top:1px solid #eee; padding-top:10px;">
                <textarea id="replyInput-${id}" class="reply-input" placeholder="Bir ≈üeyler yazƒ±n..."></textarea>
                <div id="replyPrev-${id}" class="preview-container"></div>
                <div style="display:flex; justify-content:space-between; align-items:center;">
                    <label class="file-label">üìÅ <input type="file" id="file-${id}" hidden multiple onchange="handleFiles(this, 'replyPrev-${id}', 'reply-${id}')"></label>
                    <button onclick="submitReply(${id})" style="background:#27ae60; color:white; border:none; padding:8px 20px; border-radius:5px; cursor:pointer; font-weight:bold; margin-top:10px;">Cevapla</button>
                </div>
            </div>`;
        document.getElementById('feed').prepend(card);
    }

    function submitReply(id) {
        const text = document.getElementById(`replyInput-${id}`).value;
        const storeKey = `reply-${id}`;
        if (text.trim() === "" && (!filesStore[storeKey] || filesStore[storeKey].length === 0)) return;
        
        const container = document.getElementById(`replies-${id}`);
        
        // D√ºzenlenmi≈ü Medya G√∂sterim Mantƒ±ƒüƒ±
        let mediaHtml = '<div class="reply-media">';
        (filesStore[storeKey] || []).forEach(f => {
            if (f.type.startsWith('image/')) {
                mediaHtml += `<img src="${f.data}" style="width:80px; height:80px; object-fit:cover; border-radius:5px; margin:2px;">`;
            } else if (f.type.startsWith('video/')) {
                mediaHtml += `<video src="${f.data}" controls style="width:150px; border-radius:5px; margin:2px;"></video>`;
            } else if (f.type.startsWith('audio/')) {
                mediaHtml += `<audio src="${f.data}" controls style="display:block; margin:5px 0;"></audio>`;
            } else {
                mediaHtml += `<div style="font-size:0.8rem; background:#ddd; padding:5px; border-radius:5px; display:inline-block;">üìÑ Dosya</div>`;
            }
        });
        mediaHtml += '</div>';

        const div = document.createElement('div');
        div.className = 'reply-item';
        div.innerHTML = `
            <strong>Anonim:</strong> <p style="margin:5px 0;">${text}</p> 
            ${mediaHtml}
            <div class="actions" style="margin-top:8px;">
                <button class="react-btn" onclick="toggleLike(this)">üëç <span>0</span></button>
                <button class="react-btn" onclick="toggleLike(this)">‚ù§Ô∏è <span>0</span></button>
            </div>`;
        
        container.appendChild(div);
        
        // Temizlik
        document.getElementById(`replyInput-${id}`).value = "";
        filesStore[storeKey] = [];
        renderPreviews(`replyPrev-${id}`, storeKey);
    }
</script>
</body>

</html>
